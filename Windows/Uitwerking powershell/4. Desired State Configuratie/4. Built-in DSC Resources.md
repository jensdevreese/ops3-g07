# Hoofdstuk 4: Built-in DSC Resources

- De configuratie Scripts in Windows powershell DSC zijn gebaseerd op Resources. We bespraken dit concept van DSC Resources eerder al. DSC Resources zijn PowerShell Modules met een bepaalde set van functies. Standaard zijn er 12 DSC Resources die ingebouwd zijn in WMF 4.0. In dit Hoofdstuk bekijken we de DSC Resources in Detail en hoe we deze moeten gebruiken. We zullen meerdere voorbeelden bekijken zo dat de Syntax duidelijk is en het gebruik ook.

### Exploring Built-In Resources
- Zoals eerder gezien toont 'Get-DscResource' een lijst van DSC Resources, zowel Built-in als custom. Dit zijn de 12 ingebouwde resources:
```PowerShell
PS C:\> Get-DscResource

ImplementedAs   Name                      ModuleName                     Version    Properties
-------------   ----                      ----------                     -------    ----------
Binary          File                                                                {DestinationPath, Attributes, Ch...
PowerShell      Archive                   PSDesiredStateConfiguration    1.1        {Destination, Path, Checksum, Cr...
PowerShell      Environment               PSDesiredStateConfiguration    1.1        {Name, DependsOn, Ensure, Path...}
PowerShell      Group                     PSDesiredStateConfiguration    1.1        {GroupName, Credential, DependsO...
Binary          Log                       PSDesiredStateConfiguration    1.1        {Message, DependsOn, PsDscRunAsC...
PowerShell      Package                   PSDesiredStateConfiguration    1.1        {Name, Path, ProductId, Argument...
PowerShell      Registry                  PSDesiredStateConfiguration    1.1        {Key, ValueName, DependsOn, Ensu...
PowerShell      Script                    PSDesiredStateConfiguration    1.1        {GetScript, SetScript, TestScrip...
PowerShell      Service                   PSDesiredStateConfiguration    1.1        {Name, BuiltInAccount, Credentia...
PowerShell      User                      PSDesiredStateConfiguration    1.1        {UserName, DependsOn, Descriptio...
PowerShell      WindowsFeature            PSDesiredStateConfiguration    1.1        {Name, Credential, DependsOn, En...
PowerShell      WindowsProcess            PSDesiredStateConfiguration    1.1        {Arguments, Path, Credential, De...
```
We gaan deze nu stuk voor stuk bekijken en zien wat hun voornamelijke taak is.

##### Archive Resource
- The Archive Resource wordt gebruikt om zip archieven uit te pakken naar een specifiek pad op een bepaalde node. Dit zijn de eigenschappen van de Archive Resource: 

![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Archive%20Resource.PNG)

- Met deze kennis, kunnen we enkel voorbeelden uitwerken om te zien hoe deze resource gebruikt wordt.
```PowerShell
Archive ArchiveDemo {
	Path = "C:\Scripts"
	Destination = "C:\downloads\scripts.zip"
	}
```
- In deze code zien we de minimale vereiste eigenschappen die nodig zijn om Archive te kunnen gebruiken. We geven een bestemming waar het .zip bestand geplaatst zal worden. Wanneer deze reource wordt geconfigureerd, zal de LCM kijken of de bestemming al bestaat, en indien dit zo is, zal de onhoud vergeleken worden met wat er beschikbaar is in het ZIP bestand. Komen deze overeen dan slaat LCM deze over. Wanneer we terugkijken zien we dat de checksum validatie enkel maar gebeurd bij het bestand en folder niveau waar er geen expliciete vermelding van de checksum property in het configuratie script is. Wanneer deze wel overeenkomen met de bestemming, maar 1 van de bestanden is aangepast, dan zal the Archive resource het bestand niet vervangen. Dit is waar checksum zijn rol speelt.
```PowerShell
Configuration ArchiveDemo {
	Node WSR2-1 {	
		Archive ArchiveDemo {
			Path = "C:\Scripts"
			Destination = "C:\downloads\scripts.zip"
			Checksum = "SHA-256"
			Validate = $true
			Force = $true
		}
	}
}
ArchiveDemo
```
- In het ConfiguratieScript, zeggen we dat de inhoud moet gevalideerd worden volgens SHA-256 Checksum. Gebaseerd op ons resultaat van de checksum willen we zeker zijn dat de configuratie doorgaat dus wordt deze geforceerd. LCM valideert de Checksum en vind dat bepaaldr inhoud anders is op de bestemming dan van de bron. Vervolgens pakt hij het ZIPBestand uit op de bestemming. Indien Force niet op true stond, zou de operatie hier stoppen na dat de fout in de checksum was gevonden. Dankzij -Verbose kunnen we output zien wara er effectief iets zou kunnen mislopen. 
- Bij het gebruik van een Universal Naming Convention path(vb. \\Demo-Ad\Share\Scripts.zip) naar het ZIP Archief kan het zijn dat LCM niet in de mogelijkheid is om het UNC path te bereiken. We kunnen dit aanpassen door de Computer Account Permissies toegang tot het UNC Path te geven. Dit kan door de volgende stappen te volgen.


1. Ga naar de properties van de te sharen folder, dan naar security tab en vervolgens op edit
2. In Permissions for ... , klik op ADD, klik dan op Object Types
3. Selecteer Computers en klik op OK
4. in de tekstbox voor "Enter The object names to select" vul je de Target Nodes in en valideer je door "check names"
5. Klik op Ok om af te sluiten en normaal zit je scherm er dan als volgt uit.

![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Archive%20Resource2.PNG)

##### Environment Resource
- Deze wordt gebuikt om Systeem Omgevingsvariabelen te beheren op de target nodes. Je kan bijvoorbeeld de PATH variabele op target nodes aanpassen om een pad naar een bepaalde applicatie toe te voegen, die eerder al geïnstalleerd was op het systeem. Dit zijn de eigenschappen van de environment resource: 

![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Environment%20Resource.PNG)

- Wanneer we de Environment resource gebruiken om variabelen naar path variabelen om te zetten, moeten we voorzichtig zijn aangezien sommige variablen (Path en PSModulePath) meerdere waarden hebben, gesplitst door een ;. Als we deze dus aanpassen, worden de vorige overschreven. Dit lossen we op door een extra property Path.
```PowerShell
Configuration EnvironmentDemo {
	Node WSR2-1 {
		Environment EnvironmentDemo {
			Name = "Path"
			Value = "C:\Scripts\MyModules"
			Path = $true
		}
	}
}
EnvironmentDemo
```
- de Path eigenschap neemt een Boolean waarde aan. Zodanig dat als de systeemvariabele die we configureren een Path variabele is, dan moeten we deze op true zetten.

##### File Resource
- Deze Resource wordt gebruikt om bestanden en folder te beheren op target nodes. Dit zijn alle eigenschappen van deze resource:
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/File%20Resource.PNG)

- Wanneer we een lege directory willen creëeren dan geven we dat mee aan de type property (Voorbeeld 1) en wordt er geen contents geplaatst. Contents geeft al een bepaalde inhoud mee aan een bestand. Bij een lege string wordt dus enkel een document aangemaakt zonder inhoud.
```PowerShell
###################
### Voorbeeld 1 ###
###################

Configuration FileDemo {
	Node WSR2-1 {
		File FileDemo {
			DestinationPath = "C:\DSCScripts"
			#Contents = ""
			Type = "Directory"
		}
	}
}
FileDemo

###################
### Voorbeeld 2 ###
###################

Configuration FileDemo {
	Node WSR2-1 {
		File FileDemo {
			DestinationPath = "C:\MyScripts1\Test.txt"
			Attributes = "Hidden","System"
		}
	}
}
FileDemo
```
- In voorbeeld 2 zien we dat de Attributes eigenschap wordt toegevoegd. Op deze manier kunnen we eigenschappen aan een bepaalde map toevoegen. Hier is Attributes "Hidden","System" niet geldig aangezien er geen meerdere attributen kunnen gespecifieerd worden. Er is een beperking met de File Resource en dat is dat er geen Attributen kunnen verwijderd worden eenmaal deze zijn toegekent. Force kan ook gebruikt worden om iets te overschrijven indien deze al bestaat.

##### Group Resource
- De Group Resource helpt ons om lokale groepen te beheren. Heel belangrijk is om te weten dat deze geen AD Groups beheert. Dit zijn zijn eigenschappen:
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Group%20Resource.PNG)

- Het basis gebruik van deze Resource is heel eenvoudig. We specifiëren de GroupName eigenschap met een bepaald waarde die moet worden toegekend als groepnaam, en de lokale groep wordt aangemaakt als deze nog niet bestaat. Om een bestaande groep te verwijderen kunnen we 'Ensure = Absent' toe voegen.
```PowerShell
Configuration GroupDemo {
	Node Home-Desk {
		Group GroupDemo {
			GroupName = "Group1"
			MembersToInclude = "User3"
			MembersToExclude = "User1"
		}
	}
}
GroupDemo
```
- Verder kunnen we ook leden toevoegen aan de groep. Dit kan met 'Members','MembersToInclude' en 'MemberToExclude'. In vorig script gaan we dus User 1 verwijderen van de groep en User 3 toevoegen aan de groep.

##### Log Resource
- De Log Resource wordt gebruikt om event Logs te schrijven naar het DSC Analytic event kanaal. Onthoud dat deze resource nie voor elke event log is maar specifiek voor DSC events. Deze heeft slecht 2 eigenschappen:
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Log%20Resource.PNG)

```PowerShell
Configuration LogDemo {
	Node WSR2-1 {
		Log LogDemo {
			Message = "This is a test message from DSC Demo"
		}
	}
}
LogDemo
```
- Eenmaal dat de Analytic event log ingeschakeld is, kan je met vorige code, event messages schrijven naar de DSC logs. Deze berichten kunnen ook gezien worden door te navigeren naar Application en Services Logs => Microsoft => Desired State configuration => Analytic logs container. De Log resource is in het algemeen geen resource die veel gebruikt wordt.
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Log%20Resource2.PNG)

##### Package Resource
-Met deze Resource is het mogelijk om Windows packages of setup.exe bestanden te installeren of te verwijderen van target nodes. Dit kan niet gebruikt worden voor Windows Update Packages te installeren. Deze resource bevat volgende eigenschappen: 
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Package%20Resource.PNG)

- We gaan dit duidelijk maken met een voorbeeld. We proberen een windows Installer of msi bestand te installeren en kiezen ervoor om het 7-zip pakket te installeren op mijn target node.
```PowerShell
Configuration PackageDemo {
	Node WSR2-1 {
		Package PackageDemo {
			Name = "7-Zip"
			Path = "C:\Package\7z920-x64.msi"
			ProductId = "23170F69-40C1-2702-0920-000001000000"
		}
	}
}
PackageDemo
```
- Dit is de code om het pakket op te zetten op een target node. De Name mag volledig gekozen worden en moet niets matchen. Het Path is nodig en toont het volledige 

##### WindowsProcess Resource
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/WindowsProcess%20Resource.PNG)

##### Registry Resource
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Registry%20Resource.PNG)

##### Script Resource
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Script%20Resource.PNG)

##### Service Resource
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/Service%20Resource.PNG)

##### User Resource
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/User%20Resource.PNG)

##### WindowsFeature Resource
![] (https://github.com/HoGentTIN/ops3-g07/blob/master/Windows/Individuele%20Documentatie/S%C3%A9bastien/Images/WindowsFeature%20Resource.PNG)


### Using the DependsOn Property
